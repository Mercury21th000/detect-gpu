"use strict";function e(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))}Object.defineProperty(exports,"__esModule",{value:!0});const t=[],n=[],r=(e,r)=>{if(e===r)return 0;const o=e;e.length>r.length&&(e=r,r=o);let a=e.length,i=r.length;for(;a>0&&e.charCodeAt(~-a)===r.charCodeAt(~-i);)a--,i--;let s,l,c,d,u=0;for(;u<a&&e.charCodeAt(u)===r.charCodeAt(u);)u++;if(a-=u,i-=u,0===a)return i;let p=0,f=0;for(;p<a;)n[p]=e.charCodeAt(u+p),t[p]=++p;for(;f<i;)for(s=r.charCodeAt(u+f),c=f++,l=f,p=0;p<a;p++)d=s===n[p]?c:c+1,c=t[p],l=t[p]=c>l?d>l?l+1:d:d>c?c+1:d;return l};var o=r,a=r;o.default=a;const i=(()=>{if("undefined"==typeof window)return{};const{userAgent:e,platform:t,maxTouchPoints:n}=window.navigator,r=/(iphone|ipod|ipad)/i.test(e),o="iPad"===t||"MacIntel"===t&&n>0&&!window.MSStream;return{isMobile:/android/i.test(e)||r||o,isSafari12:/Version\/12.+Safari/.test(e),isIpad:o}})(),s=(e,t,n,r)=>"apple gpu"===t?((e,t,n,r)=>{let o=[t];if(n){const t="\n      precision highp float;\n      attribute vec3 aPosition;\n      varying float vvv;\n      void main() {\n        vvv = 0.31622776601683794;\n        gl_Position = vec4(aPosition, 1.0);\n      }\n    ",n="\n      precision highp float;\n      varying float vvv;\n      void main() {\n        vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;\n        enc = fract(enc);\n        enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n        gl_FragColor = enc;\n      }\n    ",a=e.createShader(35633),s=e.createShader(35632),l=e.createProgram();if(s&&a&&l){e.shaderSource(a,t),e.shaderSource(s,n),e.compileShader(a),e.compileShader(s),e.attachShader(l,a),e.attachShader(l,s),e.linkProgram(l),e.detachShader(l,a),e.detachShader(l,s),e.deleteShader(a),e.deleteShader(s),e.useProgram(l);const c=e.createBuffer();e.bindBuffer(34962,c),e.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const d=e.getAttribLocation(l,"aPosition");e.vertexAttribPointer(d,3,5126,!1,0,0),e.enableVertexAttribArray(d),e.clearColor(1,1,1,1),e.clear(16384),e.viewport(0,0,1,1),e.drawArrays(4,0,3);const u=new Uint8Array(4);e.readPixels(0,0,1,1,6408,5121,u),e.deleteProgram(l),e.deleteBuffer(c),o={801621810:i.isIpad?["apple a12x gpu"]:["apple a11 gpu","apple a12 gpu","apple a13 gpu"],8016218135:i.isIpad?["apple a9x gpu","apple a10 gpu","apple a10x gpu"]:["apple a9 gpu","apple a10 gpu"]}[u.join("")]||o,r&&console.warn("iOS 12.2+ obfuscates its GPU type and version, using closest matches: "+o)}}else r&&console.warn("Safari 14+ obfuscates its GPU type and version, using fallback");return o})(e,t,n,r):[t],l={};exports.getGPUTier=({mobileTiers:t=[0,30,60],desktopTiers:n=[0,30,60],logging:r=!1,override:{renderer:a,isIpad:c=Boolean(i.isIpad),isMobile:d=Boolean(i.isMobile),screen:u=("undefined"==typeof window?{width:1920,height:1080}:window.screen),loadBenchmarks:p}={},glContext:f,failIfMajorPerformanceCaveat:h=!0,benchmarksURL:g="/benchmarks"}={})=>e(void 0,void 0,void 0,(function*(){const v=(t=(t=>e(void 0,void 0,void 0,(function*(){try{return yield(e=`${g}/${t}`,n=n||{},new Promise((function(t,r){var o=new XMLHttpRequest,a=[],i=[],s={},l=function(){return{ok:2==(o.status/100|0),statusText:o.statusText,status:o.status,url:o.responseURL,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},clone:l,headers:{keys:function(){return a},entries:function(){return i},get:function(e){return s[e.toLowerCase()]},has:function(e){return e.toLowerCase()in s}}}};for(var c in o.open(n.method||"get",e,!0),o.onload=function(){o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(e,t,n){a.push(t=t.toLowerCase()),i.push([t,n]),s[t]=s[t]?s[t]+","+n:n})),t(l())},o.onerror=r,o.withCredentials="include"==n.credentials,n.headers)o.setRequestHeader(c,n.headers[c]);o.send(n.body||null)}))).then(e=>e.json())}catch(e){return void console.log(e)}var e,n}))),n)=>e(void 0,void 0,void 0,(function*(){r&&console.log("queryBenchmarks",{renderer:n}),n=n.toLowerCase().replace(/angle \((.+)\)*$/,"$1").replace(/\s+([0-9]+gb|direct3d.+$)|\(r\)| \([^\)]+\)$/g,""),r&&console.log("queryBenchmarks - renderer cleaned to",{renderer:n});const e=d?["adreno","apple","mali-t","mali","nvidia","powervr"]:["intel","amd","radeon","nvidia","geforce"];let a;for(let t=0;t<e.length;t++){const r=e[t];if(n.indexOf(r)>-1){a=r;break}}if(!a)return[];r&&console.log("queryBenchmarks - found type:",{type:a});const i=`${d?"m":"d"}-${a}.json`,s=l[i]=l[i]||t(i),p=yield s;if(!p)return[];const f=(e=>{var t;const n=(e=e.replace(/\([^\)]+\)/,"")).match(/[\d]+/)||e.match(/(\W|^)([a-zA-Z]{1,3})(\W|$)/g);return null!==(t=null==n?void 0:n.join("").replace(/\W|amd/g,""))&&void 0!==t?t:""})(n),h="apple"===a;let g=p.filter(([,e])=>e===f);r&&console.log(`found ${g.length} matching entries using version '${f}':`,g.map(([e])=>e)),g.length||(g=p.filter(([e])=>e.indexOf(n)>-1),r&&console.log(`found ${g.length} matching entries comparing model names`,{matched:g}));const v=g.length;if(0===v)return[];let[m,,w,y]=v>1?g.map(e=>[e,o(n,e[0])]).sort(([,e],[,t])=>e-t)[0][0]:g[0];r&&console.log(`${n} matched closest to ${m} with the following screen sizes`,JSON.stringify(y));let b,P=Number.MAX_VALUE;const{devicePixelRatio:A}=window,S=u.width*A*(u.height*A);h&&(y=y.filter(([,,,e])=>e.indexOf(c?"ipad":"iphone")>-1));for(let e=0;e<y.length;e++){const t=y[e],[n,r]=t,o=n*r,a=Math.abs(S-o);a<P&&(P=a,b=t)}const[,,x,C]=b;return[P,w?-1:x,m,C]}));let m;const w={tier:1,type:"FALLBACK"};if(a)m=[a];else{const e=f||((e,t=!0)=>{const n={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:t,powerPreference:"high-performance",stencil:!1};e&&delete n.powerPreference;const r=document.createElement("canvas");return r.getContext("webgl",n)||r.getContext("experimental-webgl",n)||void 0})(i.isSafari12,h);if(!e)return{tier:0,type:"WEBGL_UNSUPPORTED"};const t=e.getExtension("WEBGL_debug_renderer_info");if(t&&(a=e.getParameter(t.UNMASKED_RENDERER_WEBGL).toLowerCase()),!a)return w;m=s(e,a,d,r)}const y=yield Promise.all(m.map(e=>v(p,e))),b=1===y.length?y[0]:y.sort(([e=Number.MAX_VALUE],[t=Number.MAX_VALUE])=>e-t)[0];if(0===b.length)return w;const[,P,A,S]=b;if(-1===P)return{tier:0,type:"BLACKLISTED",fps:P,model:A,device:S};const x=d?t:n;let C=0;for(let e=0;e<x.length;e++)P>=x[e]&&(C=e);return{tier:C,type:"BENCHMARK",fps:P,model:A,device:S}}));
